services:
  dolt:
    image: dolthub/dolt-sql-server:latest
    container_name: glitchlab-dolt
    ports:
      - "3306:3306"
    volumes:
      - dolt-data:/var/lib/dolt
    entrypoint: ["sh", "-c"]
    command:
      - |
        mkdir -p /var/lib/dolt/glitchlab &&
        cd /var/lib/dolt/glitchlab &&
        [ -d .dolt ] || dolt init --name glitchlab --email glitchlab@localhost &&
        cd /var/lib/dolt &&
        exec dolt sql-server --host 0.0.0.0 --port 3306
    restart: unless-stopped

volumes:
  dolt-data:
