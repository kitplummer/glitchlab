tasks:
- id: display-pipeline-status
  objective: |
    Add a `Display` trait implementation for the `PipelineStatus` enum in
    `crates/kernel/src/pipeline.rs`. The enum has 19 variants (PrCreated through
    Error). Use human-readable lowercase output matching the serde rename_all
    snake_case pattern, e.g. PrCreated -> "pr created", TestsFailed -> "tests failed",
    BudgetExceeded -> "budget exceeded", etc. Add a unit test in the existing
    `#[cfg(test)] mod tests` block that verifies all 19 variants produce the
    expected string via `.to_string()`. The enum starts around line 141. Use
    `read_file` to read lines 139-180 to see all variants.
  priority: 10
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'objective references protected path(s): crates/kernel/src/pipeline.rs`.'
  remediation_depth: 0
  is_remediation: false
- id: display-pattern-kind
  objective: |
    Add a `Display` trait implementation for the `PatternKind` enum in
    `crates/eng-org/src/tqm.rs`. The enum has 9 variants: DecompositionLoop,
    ScopeCreep, ModelDegradation, StuckAgents, TestFlakiness,
    ArchitectRejectionRate, BudgetPressure, ProviderFailures, BoundaryViolation.
    Use human-readable output like "decomposition loop", "scope creep",
    "model degradation", "stuck agents", "test flakiness",
    "architect rejection rate", "budget pressure", "provider failures",
    "boundary violation". Add a unit test in the existing `#[cfg(test)] mod tests`
    block that verifies all 9 variants produce the expected string via
    `.to_string()`. The enum starts around line 113. Use `read_file` to read
    lines 110-132.
  priority: 20
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'implementer failed: repeated_results'
  remediation_depth: 0
  is_remediation: false
- id: display-failure-category
  objective: |
    Add a `Display` trait implementation for the `FailureCategory` enum in
    `crates/eng-org/src/orchestrator.rs`. The enum has 9 variants: SetupError,
    PlanFailed, ImplementationFailed, TestsFailed, ArchitectRejected,
    MaxAttemptsExceeded, BudgetExceeded, Timeout, Other. Use human-readable
    output like "setup error", "plan failed", "tests failed", etc. Add a unit
    test in the existing `#[cfg(test)] mod tests` block that verifies all 9
    variants produce the expected string via `.to_string()`. The enum starts
    around line 428. Use `read_file` to read lines 426-454 to see all variants.
  priority: 30
  status: completed
  depends_on: []
  decomposition_depth: 0
  pr_url: https://github.com/kitplummer/glitchlab/pull/36
  remediation_depth: 0
  is_remediation: false
- id: display-obstacle-kind
  objective: |
    Add a `Display` trait implementation for the `ObstacleKind` enum in
    `crates/kernel/src/outcome.rs`. The enum has 8 variants: MissingPrerequisite,
    ArchitecturalGap, ModelLimitation, ExternalDependency, ScopeTooLarge,
    TestFailure, ParseFailure, Unknown. Each variant has associated data, so the
    Display impl should include the variant name as a human-readable label:
    "missing prerequisite", "architectural gap", "model limitation", etc.
    Do NOT include the inner field values — just the kind label. Add a unit test
    in the existing `#[cfg(test)] mod tests` block at the end of outcome.rs that
    constructs each variant with dummy data and verifies `.to_string()`. The enum
    starts around line 43. Use `read_file` to read lines 41-70.
  priority: 40
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'objective references protected path(s): crates/kernel/src/outcome.rs`.'
  remediation_depth: 0
  is_remediation: false
- id: display-outcome-counter
  objective: |
    Add a `Display` trait implementation for the `OutcomeCounter` enum in
    `crates/eng-org/src/orchestrator.rs`. The enum has 5 variants: Succeeded,
    Failed, Deferred, Escalated, None. Use human-readable lowercase output:
    "succeeded", "failed", "deferred", "escalated", "none". Add a unit test
    in the existing `#[cfg(test)] mod tests` block that verifies all 5 variants
    produce the expected string via `.to_string()`. The enum starts around
    line 365. Use `read_file` to read lines 363-371.
  priority: 50
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'budget exceeded: token limit exceeded: 150763 / 120000 tokens used'
  remediation_depth: 0
  is_remediation: false
- id: config-limits-validation
  objective: |
    Add a `validate()` method to `LimitsConfig` in `crates/eng-org/src/config.rs`.
    The method should check: (1) `max_fix_attempts > 0`, (2) `max_tool_turns > 0`,
    (3) `max_tokens_per_task > 0`, (4) `max_dollars_per_task > 0.0`,
    (5) `repair_budget_fraction` is between 0.0 and 1.0 inclusive. Return
    `Result<()>` using the existing `glitchlab_kernel::error::Error` type with
    a descriptive message for each violation. Call this method from
    `EngConfig::load()` after deserialization. Add a unit test that verifies
    each invalid value is rejected. The `LimitsConfig` struct starts around
    line 100. Use `read_file` to read lines 98-135.
  priority: 60
  status: completed
  depends_on: []
  decomposition_depth: 0
  remediation_depth: 0
  is_remediation: false
- id: config-repair-budget-fraction-default
  objective: |
    Ensure the `repair_budget_fraction` field in `LimitsConfig` in
    `crates/eng-org/src/config.rs` has a proper serde default of `0.20`.
    Currently the defaults are set in a `Default` impl around line 170.
    Check that `repair_budget_fraction` defaults to `0.20` and that the
    `max_remediation_depth` field defaults to `1`. If these defaults are
    already correct, add a unit test that verifies them. If they're missing
    or wrong, fix them and add the test. Use `read_file` to read lines
    165-195.
  priority: 70
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'budget exceeded: token limit exceeded: 120360 / 120000 tokens used'
  remediation_depth: 0
  is_remediation: false
- id: file-size-guard-indexer
  objective: |
    Add a file-size guard to `build_index()` in `crates/eng-org/src/indexer.rs`.
    Currently the indexer collects all files from `git ls-files` without checking
    size. Add a constant `MAX_FILE_SIZE_BYTES: u64 = 1_048_576` (1 MiB) and skip
    files larger than this threshold during index building. Use
    `std::fs::metadata(path).map(|m| m.len())` to check size, and silently skip
    files that exceed the limit (log at `tracing::debug!` level). Add a unit test
    that creates a temp file larger than 1 MiB and verifies `is_oversized()` or
    equivalent returns true. The `build_index` function starts around line 139.
    Use `read_file` to read lines 139-216.
  priority: 80
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'implementer failed: repeated_results'
  remediation_depth: 0
  is_remediation: false
- id: sanitize-task-id
  objective: |
    Add a `sanitize_task_id()` function in `crates/eng-org/src/taskqueue.rs`
    that ensures task IDs are valid git branch suffixes. The function should:
    (1) lowercase the input, (2) replace spaces and underscores with hyphens,
    (3) strip characters not in `[a-z0-9-]`, (4) collapse consecutive hyphens,
    (5) trim leading/trailing hyphens. Call this from `Task::new()` or wherever
    tasks are created. Add unit tests for edge cases: spaces, uppercase,
    special chars, empty string, already-valid input. The Task struct is around
    line 42. Use `read_file` to read lines 40-70.
  priority: 100
  status: completed
  depends_on: []
  decomposition_depth: 0
  remediation_depth: 0
  is_remediation: false
- id: budget-logging-cumulative
  objective: |
    Add structured `tracing` logging to `CumulativeBudget` in
    `crates/eng-org/src/orchestrator.rs`. Log at `info!` level when: (1) a cost
    is recorded (`record()` method), including task_id, cost, and remaining
    budget, (2) repair cost is recorded (`record_repair()`), including repair
    remaining. Log at `warn!` level when remaining budget drops below 20% of
    the limit. Use structured fields: `tracing::info!(task_id = %id, cost = cost,
    remaining = self.remaining_dollars(), "budget: recorded cost")`. Do NOT add
    logging to hot paths — only to the `record()` and `record_repair()` methods.
    Add a unit test that verifies the logging doesn't panic (call the methods
    and check the return values, not the log output). The struct starts around
    line 43. Use `read_file` to read lines 43-204.
  priority: 120
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'implementer failed: repeated_results'
  remediation_depth: 0
  is_remediation: false
- id: cascade-fallback-chooser
  objective: |
    Add a `fallback_for_role()` method to `ModelChooser` in
    `crates/router/src/chooser.rs`. When `choose_for_role()` returns `None`
    (no model matches the role's minimum tier + required capabilities), the
    fallback should return the cheapest available model regardless of tier.
    This prevents pipeline stalls when the model pool is misconfigured.
    Add unit tests: (1) normal selection works, (2) fallback returns cheapest
    model when no exact match, (3) returns `None` only when the pool is empty.
    Use `read_file` to read the entire `chooser.rs` file.
  priority: 140
  status: completed
  depends_on: []
  decomposition_depth: 0
  pr_url: https://github.com/kitplummer/glitchlab/pull/49
  remediation_depth: 0
  is_remediation: false
- id: display-model-tier
  objective: |
    The `ModelTier` enum in `crates/router/src/chooser.rs` already has a
    `Display` impl. Verify that it has a corresponding unit test. If no test
    exists for `ModelTier::fmt()`, add one in the existing `#[cfg(test)]` block
    that checks `Economy.to_string() == "economy"`, `Standard.to_string() ==
    "standard"`, `Premium.to_string() == "premium"`. The enum and its Display
    impl start around line 20. Use `read_file` to read lines 18-50.
  priority: 160
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'budget exceeded: token limit exceeded: 123769 / 120000 tokens used'
  remediation_depth: 0
  is_remediation: false
- id: config-docs-yaml-comments
  objective: |
    Add inline YAML comments to the default config embedded in
    `crates/eng-org/src/config.rs` (the `DEFAULT_CONFIG` constant or the
    `Default` impl). Each field should have a one-line comment explaining its
    purpose and valid range. For example: `max_fix_attempts: 3  # Max debug
    retries per task (1-10)`. Also update the `RoutingConfig` defaults to include
    comments noting that model strings follow the `provider/model-name` format.
    This is a documentation-only change — no logic changes. Use `read_file` to
    find the DEFAULT_CONFIG constant or Default impl. Verify `cargo test` still
    passes after the change.
  priority: 180
  status: completed
  depends_on: []
  decomposition_depth: 0
  remediation_depth: 0
  is_remediation: false
- id: worktree-cleanup-timeout
  objective: |
    Add a timeout to the `cleanup()` method in `crates/eng-org/src/workspace.rs`.
    Currently `git worktree remove --force` can hang if a process holds a lock
    on the worktree. Wrap the cleanup command in `tokio::time::timeout()` with
    a 30-second deadline. If the timeout fires, fall through to the existing
    `remove_dir_all` fallback and log a warning. Add a unit test that verifies
    `cleanup()` succeeds even when the worktree path doesn't exist (no-op case).
    The `cleanup()` method starts around line 136. Use `read_file` to read
    lines 134-160.
  priority: 200
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'budget exceeded: token limit exceeded: 120184 / 120000 tokens used'
  remediation_depth: 0
  is_remediation: false
- id: test-restart-intensity-monitor
  objective: |
    Add unit tests for `RestartIntensityMonitor` in
    `crates/eng-org/src/orchestrator.rs`. The struct is private (no `pub`),
    so tests must be in the same module's `#[cfg(test)]` block. Test:
    (1) recording fewer than `max_failures` returns `None`,
    (2) recording exactly `max_failures` within the window returns
    `Some(dominant_category)`, (3) failures outside the window are evicted
    and don't count, (4) the dominant category is correct when multiple
    categories are mixed. The struct starts around line 477. Use `read_file`
    to read lines 470-530.
  priority: 220
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'budget exceeded: token limit exceeded: 120747 / 120000 tokens used'
  remediation_depth: 0
  is_remediation: false
- id: test-attempt-tracker
  objective: |
    Add unit tests for `AttemptTracker` in
    `crates/eng-org/src/orchestrator.rs`. Test: (1) `count()` returns 0
    for unknown task_id, (2) `record()` increments count correctly,
    (3) `contexts()` returns recorded `OutcomeContext` values in order,
    (4) multiple task_ids are tracked independently. The struct starts
    around line 382. Use `read_file` to read lines 375-420.
  priority: 240
  status: completed
  depends_on: []
  decomposition_depth: 0
  pr_url: https://github.com/kitplummer/glitchlab/pull/54
  remediation_depth: 0
  is_remediation: false
- id: test-quality-gate
  objective: |
    Add unit tests for `QualityGate` (the `run_quality_gate` function) in
    `crates/eng-org/src/orchestrator.rs`. Test: (1) a passing command
    (e.g. `echo ok`) returns `QualityResult { passed: true, ... }`,
    (2) a failing command (e.g. `false`) returns `passed: false`,
    (3) a non-existent command returns `passed: false` with an error message.
    These are async tests — use `#[tokio::test]`. The function starts around
    line 210. Use `read_file` to read lines 208-270.
  priority: 260
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'implementer failed: parse_error'
  remediation_depth: 0
  is_remediation: false
- id: test-cumulative-budget
  objective: |
    Add unit tests for `CumulativeBudget` in
    `crates/eng-org/src/orchestrator.rs`. Test: (1) `new()` with a limit
    has correct `remaining_dollars()`, (2) `record()` reduces remaining,
    (3) `can_afford()` returns false when remaining < requested,
    (4) `record_repair()` tracks repair spending separately,
    (5) `repair_remaining()` respects `repair_budget_fraction`. The struct
    starts around line 43. Use `read_file` to read lines 43-204.
  priority: 280
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'budget exceeded: token limit exceeded: 133391 / 120000 tokens used'
  remediation_depth: 0
  is_remediation: false
- id: test-security-parse-error
  objective: |
    Add a test in `crates/eng-org/src/agents/security.rs` that verifies the
    SecurityAgent handles a malformed (non-JSON) LLM response gracefully.
    The agent uses `parse_json_response()` from `agents/parse.rs`. Create a
    mock router that returns garbage text instead of valid JSON. Verify that
    the agent returns an `AgentOutput` with `parse_error: true` in the JSON
    (graceful degradation). Look at the existing test pattern in the file's
    `#[cfg(test)]` block starting around line 111. Use `read_file` to read
    the full file.
  priority: 300
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: no changes produced — implementer output resulted in an empty commit
  remediation_depth: 0
  is_remediation: false
- id: test-archivist-parse-error
  objective: |
    Add a test in `crates/eng-org/src/agents/archivist.rs` that verifies the
    ArchivistAgent handles a malformed LLM response gracefully. Follow the same
    pattern as the security agent parse-error test: mock router returning garbage,
    verify the output contains `parse_error: true`. The existing `#[cfg(test)]`
    block starts around line 100. Use `read_file` to read the full file.
  priority: 320
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: debugger recommends not retrying
  remediation_depth: 0
  is_remediation: false
- id: test-release-parse-error
  objective: |
    Add a test in `crates/eng-org/src/agents/release.rs` that verifies the
    ReleaseAgent handles a malformed LLM response gracefully. Follow the same
    pattern: mock router returning garbage text, verify graceful degradation
    with `parse_error: true`. The existing `#[cfg(test)]` block starts around
    line 101. Use `read_file` to read the full file.
  priority: 340
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'implementer failed: parse_error'
  remediation_depth: 0
  is_remediation: false
- id: test-architect-triage-parse-error
  objective: |
    Add a test in `crates/eng-org/src/agents/architect.rs` that verifies the
    ArchitectTriageAgent handles a malformed LLM response gracefully. The file
    contains two agents (ArchitectTriageAgent and ArchitectReviewAgent). Test
    the triage agent specifically: mock router returning garbage, verify
    `parse_error: true`. The existing `#[cfg(test)]` block starts around
    line 207. Use `read_file` to read the full file.
  priority: 350
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'debugger failed: budget exceeded: token limit exceeded: 126498 / 120000 tokens used'
  remediation_depth: 0
  is_remediation: false
- id: test-architect-review-parse-error
  objective: |
    Add a test in `crates/eng-org/src/agents/architect.rs` that verifies the
    ArchitectReviewAgent handles a malformed LLM response gracefully. This is
    the second agent in the file. Mock router returning garbage text, verify
    `parse_error: true` in the output. Add to the existing `#[cfg(test)]`
    block around line 207. Use `read_file` to read the full file.
  priority: 360
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'budget exceeded: token limit exceeded: 124580 / 120000 tokens used'
  remediation_depth: 0
  is_remediation: false
- id: status-md-update
  objective: |
    Create or update `.glitchlab/STATUS.md` with the current project status.
    Include: (1) total Rust LOC count (run `tokei crates/` or `wc -l`),
    (2) agent count (9: Planner, Implementer, Debugger, Security, Release,
    Archivist, ArchitectTriage, ArchitectReview, OpsDiagnosis),
    (3) pipeline stage count (15+ stages), (4) TQM pattern count (9 patterns),
    (5) test count (run `cargo test --workspace 2>&1 | tail -1`),
    (6) coverage percentage (from last `cargo tarpaulin` run if available),
    (7) a brief "what works" section listing proven capabilities. Keep it
    under 50 lines. This is a Markdown file, not compiled.
  priority: 400
  status: completed
  depends_on: []
  decomposition_depth: 0
  pr_url: https://github.com/kitplummer/glitchlab/pull/55
  remediation_depth: 0
  is_remediation: false
- id: model-pool-config-doc
  objective: |
    Add a `.glitchlab/docs/model-pool.md` file documenting the ModelChooser
    configuration. Explain: (1) the `routing.models[]` array schema (model,
    tier, capabilities), (2) the `routing.roles{}` map schema (min_tier,
    requires), (3) how the chooser selects models (filter by tier >= min_tier,
    then by required capabilities, then cheapest), (4) the
    `cost_quality_threshold` field, (5) example configs for budget-constrained
    and quality-focused setups. Reference `crates/router/src/chooser.rs` for
    the implementation. Keep under 80 lines.
  priority: 440
  status: completed
  depends_on: []
  decomposition_depth: 0
  pr_url: https://github.com/kitplummer/glitchlab/pull/56
  remediation_depth: 0
  is_remediation: false
- id: readme-update
  objective: |
    The README.md has already been rewritten manually to reflect the Rust port.
    Verify that it accurately describes: (1) the crate layout, (2) the agent
    roster (9 agents), (3) install instructions (cargo build), (4) the
    architecture diagram, (5) the cost model. If any section is inaccurate or
    missing, fix it. This is a verification/polish pass, not a full rewrite.
  priority: 460
  status: completed
  depends_on: []
  decomposition_depth: 0
  remediation_depth: 0
  is_remediation: false
- id: pipeline-mode-enum
  objective: |
    Add a `PipelineMode` enum to `crates/eng-org/src/pipeline.rs` with variants:
    `Full` (all stages), `PlanOnly` (stop after planning), `SkipSecurity`
    (skip security review), `DryRun` (plan + implement but don't commit/PR).
    Add it as a field on `EngineeringPipeline` and gate the security and
    PR-creation stages on the mode. Default to `Full`. Add a `Display` impl
    and unit tests for the enum. The `EngineeringPipeline` struct is near the
    top of the file. Use `read_file` to read lines 1-60 to find it.
  priority: 500
  status: completed
  depends_on: []
  decomposition_depth: 0
  remediation_depth: 0
  is_remediation: false
- id: indexer-inline-test-detection
  objective: |
    Extend `is_test_file()` in `crates/eng-org/src/indexer.rs` to also detect
    Rust files with inline `#[cfg(test)]` modules. Add a new function
    `has_inline_tests(path: &Path) -> bool` that reads the first 100 lines of
    a `.rs` file and checks for `#[cfg(test)]` or `#[test]`. This is cheaper
    than reading the entire file. Add it as an optional second pass in
    `build_index()` — call it only for `.rs` files not already classified as
    test files. Add a `has_inline_tests` field to `RepoIndex`. Add unit tests
    with a temp `.rs` file containing `#[cfg(test)]`. The `is_test_file()`
    function starts around line 218. Use `read_file` to read lines 216-246.
  priority: 540
  status: completed
  depends_on: []
  decomposition_depth: 0
  remediation_depth: 0
  is_remediation: false
- id: intentional-kernel-violation
  objective: |
    THIS TASK IS INTENTIONALLY DESIGNED TO FAIL. It exercises the Circuit agent
    and BoundaryViolation detection path.

    Objective: "Add a `debug_dump()` method to the `Agent` trait in
    `crates/kernel/src/agent.rs` that prints all agent state to stderr."

    This task touches `crates/kernel/`, which is a protected path in
    `.glitchlab/config.yaml`. The pipeline should detect the boundary violation
    at the BoundaryChecked stage and return `PipelineStatus::BoundaryViolation`.
    The TQM should detect a `BoundaryViolation` pattern. The Circuit agent
    should diagnose the violation and NOT generate a remediation task (since
    kernel changes require escalation).

    Expected outcome: Failed with BoundaryViolation, TQM pattern detected,
    Circuit escalates. This validates the entire self-repair path.
  priority: 550
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'objective references protected path(s): crates/kernel, crates/kernel/src/agent.rs'
  remediation_depth: 0
  is_remediation: false
- id: circuit-fix-0-7371f136
  objective: Review and correct the resource access logic within the 'display-pipeline-status' task to ensure it only accesses permitted paths.
  priority: 2
  status: failed
  depends_on: []
  decomposition_depth: 0
  error: 'budget exceeded: token limit exceeded: 130074 / 120000 tokens used'
  remediation_depth: 1
  is_remediation: true
- id: add-limits-config-validation-part1
  objective: Implement the `validate()` method for `LimitsConfig` in `crates/eng-org/src/config.rs`, performing all specified checks and returning `Result<()>` using `glitchlab_kernel::error::Error::Message` for violations.
  priority: 50
  status: failed
  depends_on: []
  decomposition_depth: 1
  error: 'budget exceeded: token limit exceeded: 135543 / 120000 tokens used'
  remediation_depth: 0
  is_remediation: false
- id: add-limits-config-validation-part2
  objective: Locate the `EngConfig::load()` method (or similar deserialization entry point) in `crates/eng-org/src/config.rs` and call `self.limits.validate()?` after deserialization to ensure loaded configurations are valid.
  priority: 50
  status: pending
  depends_on:
  - add-limits-config-validation-part1
  decomposition_depth: 1
  remediation_depth: 0
  is_remediation: false
- id: add-limits-config-validation-part3
  objective: Add a unit test module (`#[cfg(test)] mod tests`) to `crates/eng-org/src/config.rs` and include test cases that verify `LimitsConfig::validate()` correctly rejects invalid configurations for each specified rule.
  priority: 50
  status: pending
  depends_on:
  - add-limits-config-validation-part1
  decomposition_depth: 1
  remediation_depth: 0
  is_remediation: false
- id: add-task-id-sanitization-part1
  objective: Implement the `sanitize_task_id` function in `crates/eng-org/src/taskqueue.rs` that transforms a string into a valid git branch suffix by lowercasing, replacing spaces/underscores with hyphens, stripping invalid characters, collapsing consecutive hyphens, and trimming leading/trailing hyphens.
  priority: 50
  status: failed
  depends_on: []
  decomposition_depth: 1
  error: 'budget exceeded: token limit exceeded: 132483 / 120000 tokens used'
  remediation_depth: 0
  is_remediation: false
- id: add-task-id-sanitization-part2
  objective: Add a `#[cfg(test)] mod tests` block to `crates/eng-org/src/taskqueue.rs` and write unit tests for the `sanitize_task_id` function, covering edge cases like spaces, uppercase, special characters, empty string, and already-valid input.
  priority: 50
  status: pending
  depends_on:
  - add-task-id-sanitization-part1
  decomposition_depth: 1
  remediation_depth: 0
  is_remediation: false
- id: add-task-id-sanitization-part3
  objective: Integrate the `sanitize_task_id` function by calling it on the `id` field within the `bead_to_task` helper function in `crates/eng-org/src/taskqueue.rs` to ensure all task IDs derived from Beads are properly sanitized.
  priority: 50
  status: pending
  depends_on:
  - add-task-id-sanitization-part1
  decomposition_depth: 1
  remediation_depth: 0
  is_remediation: false
- id: add-config-comments-part1-routing
  objective: Add inline comments to the `RoutingConfig` fields within the `EngConfig::default()` implementation in `crates/eng-org/src/config.rs`. Ensure comments note the `provider/model-name` format for model strings.
  priority: 50
  status: completed
  depends_on: []
  decomposition_depth: 1
  pr_url: https://github.com/kitplummer/glitchlab/pull/50
  remediation_depth: 0
  is_remediation: false
- id: add-config-comments-part2-limits
  objective: Add inline comments to the `LimitsConfig` fields within the `EngConfig::default()` implementation in `crates/eng-org/src/config.rs`, explaining purpose and valid ranges.
  priority: 50
  status: completed
  depends_on: []
  decomposition_depth: 1
  pr_url: https://github.com/kitplummer/glitchlab/pull/51
  remediation_depth: 0
  is_remediation: false
- id: add-config-comments-part3-intervention
  objective: Add inline comments to the `InterventionConfig` fields within the `EngConfig::default()` implementation in `crates/eng-org/src/config.rs`, explaining their purpose.
  priority: 50
  status: completed
  depends_on: []
  decomposition_depth: 1
  pr_url: https://github.com/kitplummer/glitchlab/pull/52
  remediation_depth: 0
  is_remediation: false
- id: add-config-comments-part4-workspace-boundaries
  objective: Add inline comments to the `WorkspaceConfig` and `BoundariesConfig` fields within the `EngConfig::default()` implementation in `crates/eng-org/src/config.rs`, explaining their purpose.
  priority: 50
  status: completed
  depends_on: []
  decomposition_depth: 1
  pr_url: https://github.com/kitplummer/glitchlab/pull/53
  remediation_depth: 0
  is_remediation: false
- id: add-config-comments-part5-memory-toplevel
  objective: Add inline comments to the `MemoryConfig` fields and the remaining top-level `EngConfig` fields (e.g., `allowed_tools`, `blocked_patterns`, `test_command_override`, `providers`, `tqm`) within the `EngConfig::default()` implementation in `crates/eng-org/src/config.rs`, explaining their purpose.
  priority: 50
  status: failed
  depends_on: []
  decomposition_depth: 1
  error: 'budget exceeded: token limit exceeded: 132072 / 120000 tokens used'
  remediation_depth: 0
  is_remediation: false
- id: circuit-fix-0-0708e44b
  objective: Investigate and fix the parsing logic in the archivist component that is causing 'test-archivist-parse-error' to fail.
  priority: 2
  status: completed
  depends_on: []
  decomposition_depth: 0
  remediation_depth: 1
  is_remediation: true
- id: circuit-fix-1-e72f1a69
  objective: Investigate and fix the parsing logic in the architect component that is causing 'test-architect-triage-parse-error' to fail.
  priority: 2
  status: completed
  depends_on: []
  decomposition_depth: 0
  remediation_depth: 1
  is_remediation: true
- id: archivist-parse-fix-part1
  objective: Investigate the parsing logic within the Rust archivist agent to identify the root cause of the 'test-archivist-parse-error'. Focus on how the agent processes input or internal data structures.
  priority: 50
  status: failed
  depends_on: []
  decomposition_depth: 1
  error: 'implementer failed: repeated_results'
  remediation_depth: 0
  is_remediation: false
- id: archivist-parse-fix-part2
  objective: Implement the necessary fix to the identified parsing logic in `crates/eng-org/src/agents/archivist.rs` and add a new, targeted test case to `crates/eng-org/tests/memory_integration.rs` (or a new dedicated test file) that reproduces the original parse error and verifies the correction.
  priority: 50
  status: pending
  depends_on:
  - archivist-parse-fix-part1
  decomposition_depth: 1
  remediation_depth: 0
  is_remediation: false
- id: architect-parse-fix-part1
  objective: Investigate the parsing logic within `crates/eng-org/src/agents/architect.rs` to understand how it processes input during the triage phase and identify potential causes for 'token limit exceeded' errors. Pay close attention to any calls to shared parsing utilities in `crates/eng-org/src/agents/parse.rs`.
  priority: 50
  status: failed
  depends_on: []
  decomposition_depth: 1
  error: no changes produced — implementer output resulted in an empty commit
  remediation_depth: 0
  is_remediation: false
- id: architect-parse-fix-part2
  objective: Implement a fix for the identified parsing issue in `crates/eng-org/src/agents/architect.rs` (or `crates/eng-org/src/agents/parse.rs` if the root cause is there). The fix should address the 'token limit exceeded' error, potentially by optimizing parsing, adding input size validation, or handling malformed/large inputs more robustly.
  priority: 50
  status: pending
  depends_on:
  - architect-parse-fix-part1
  decomposition_depth: 1
  remediation_depth: 0
  is_remediation: false
- id: add-pipeline-mode-enum
  objective: Add the `PipelineMode` enum with `Full`, `PlanOnly`, `SkipSecurity`, `DryRun` variants to `crates/eng-org/src/pipeline.rs`, implement `std::fmt::Display` for it, and add unit tests.
  priority: 50
  status: failed
  depends_on: []
  decomposition_depth: 1
  error: 'budget exceeded: token limit exceeded: 120753 / 120000 tokens used'
  remediation_depth: 0
  is_remediation: false
- id: add-mode-to-engineering-pipeline
  objective: 'Add a `pub pipeline_mode: PipelineMode` field to the `EngineeringPipeline` struct in `crates/eng-org/src/pipeline.rs` and initialize it to `PipelineMode::Full` in its constructor.'
  priority: 50
  status: pending
  depends_on:
  - add-pipeline-mode-enum
  decomposition_depth: 1
  remediation_depth: 0
  is_remediation: false
- id: gate-pipeline-stages
  objective: Modify the `EngineeringPipeline`'s `run` method (or related stage-specific methods) in `crates/eng-org/src/pipeline.rs` to gate the security review and PR creation stages based on the `pipeline_mode` field.
  priority: 50
  status: pending
  depends_on:
  - add-mode-to-engineering-pipeline
  decomposition_depth: 1
  remediation_depth: 0
  is_remediation: false
- id: indexer-inline-tests-part1
  objective: 'Add `has_inline_tests: bool` field to the `RepoIndex` struct in `crates/eng-org/src/indexer.rs`.'
  priority: 50
  status: failed
  depends_on: []
  decomposition_depth: 1
  error: 'budget exceeded: token limit exceeded: 131089 / 120000 tokens used'
  remediation_depth: 0
  is_remediation: false
- id: indexer-inline-tests-part2
  objective: 'Implement a private helper function `has_inline_tests_in_file(path: &Path) -> bool` in `crates/eng-org/src/indexer.rs`. This function should read the first 100 lines of a `.rs` file and check for `#[cfg(test)]` or `#[test]` patterns.'
  priority: 50
  status: failed
  depends_on: []
  decomposition_depth: 1
  error: 'budget exceeded: token limit exceeded: 126036 / 120000 tokens used'
  remediation_depth: 0
  is_remediation: false
- id: indexer-inline-tests-part3
  objective: Extend the `is_test_file()` function in `crates/eng-org/src/indexer.rs` to call `has_inline_tests_in_file()` for `.rs` files that are not already classified as test files by existing path/filename patterns. If `has_inline_tests_in_file()` returns true, `is_test_file()` should also return true.
  priority: 50
  status: pending
  depends_on:
  - indexer-inline-tests-part2
  decomposition_depth: 1
  remediation_depth: 0
  is_remediation: false
- id: indexer-inline-tests-part4
  objective: Modify `build_index()` in `crates/eng-org/src/indexer.rs` to track if any `.rs` file was classified as a test file due to inline tests (i.e., `has_inline_tests_in_file()` returned true). Populate the `RepoIndex.has_inline_tests` field with this aggregate boolean value.
  priority: 50
  status: pending
  depends_on:
  - indexer-inline-tests-part1
  - indexer-inline-tests-part3
  decomposition_depth: 1
  remediation_depth: 0
  is_remediation: false
- id: indexer-inline-tests-part5
  objective: Add unit tests in `crates/eng-org/src/indexer.rs` for the new `has_inline_tests_in_file` function, for `is_test_file` with a temporary file containing inline tests, and for `build_index` to verify the `RepoIndex.has_inline_tests` field is correctly set.
  priority: 50
  status: pending
  depends_on:
  - indexer-inline-tests-part1
  - indexer-inline-tests-part2
  - indexer-inline-tests-part3
  - indexer-inline-tests-part4
  decomposition_depth: 1
  remediation_depth: 0
  is_remediation: false
# ── Canary: t-shirt sizing validation (one per size) ──
- id: canary-size-s-display-model-profile
  objective: |
    Add a `Display` trait implementation for the `ModelProfile` struct in
    `crates/router/src/chooser.rs`. The struct has fields `model: String`,
    `tier: ModelTier`, and `capabilities: Vec<String>`. Display should output
    a compact human-readable format: `"{model} ({tier})"`, e.g.
    `"gemini/gemini-2.5-flash (standard)"`. Add a unit test in the existing
    `#[cfg(test)]` block that constructs a `ModelProfile` and verifies
    `.to_string()` output. This is a single-file, ≤2-edit mechanical change.
    Use `read_file` to read lines 1-60 of `chooser.rs`.
  priority: 10
  status: pending
  depends_on: []
  decomposition_depth: 0
  remediation_depth: 0
  is_remediation: false
- id: canary-size-m-role-preference-derives
  objective: |
    Add `Display`, `PartialEq`, and `Eq` derives/impls for the
    `RolePreference` struct in `crates/router/src/chooser.rs`. The struct
    has `min_tier: ModelTier` and `requires: Vec<String>`. Display format:
    `"min_tier={tier}, requires=[{caps}]"` e.g. `"min_tier=standard,
    requires=[tool_use, code]"`. Derive `PartialEq` and `Eq`. Add 2-3 unit
    tests: (1) Display with capabilities, (2) Display with empty requires,
    (3) PartialEq equality and inequality. This is a 1-file, ~4-edit change.
    Use `read_file` to read lines 60-120 of `chooser.rs`.
  priority: 10
  status: pending
  depends_on: []
  decomposition_depth: 0
  remediation_depth: 0
  is_remediation: false
- id: canary-size-l-provider-error-diagnostics
  objective: |
    Extract provider error diagnostics into a new module
    `crates/router/src/provider_diagnostics.rs`. Create a
    `ProviderDiagnostic` struct with fields: `provider: String`,
    `error_code: Option<u16>`, `category: ErrorCategory`, `retryable: bool`,
    `message: String`. Add an `ErrorCategory` enum with variants:
    `RateLimit`, `AuthFailure`, `ModelNotFound`, `ContentFilter`,
    `ServerError`, `Unknown`. Add a `classify_error(provider: &str,
    status: u16, body: &str) -> ProviderDiagnostic` function that maps
    HTTP status codes to categories (429→RateLimit, 401/403→AuthFailure,
    404→ModelNotFound, 500-599→ServerError, etc.). Add the module to
    `crates/router/src/lib.rs`. Add comprehensive unit tests covering all
    status code mappings and edge cases. This is a 2-file, design-required
    change (new module + lib.rs registration).
  priority: 10
  status: pending
  depends_on: []
  decomposition_depth: 0
  remediation_depth: 0
  is_remediation: false
- id: canary-size-xl-router-instrumentation
  objective: |
    Add comprehensive tracing instrumentation to the Router and ModelChooser.
    Changes span 4+ files:
    (1) `crates/router/src/router.rs` — add `tracing::info_span!` to
    `chat()`, `chat_with_tools()`, and `resize_budget()` with fields for
    model, role, token count, cost, latency_ms.
    (2) `crates/router/src/chooser.rs` — add `tracing::debug!` to
    `choose_for_role()` logging candidate models, selected model, and
    rejection reasons.
    (3) `crates/router/src/budget.rs` — add `tracing::info!` to `record()`
    logging cumulative spend vs limit, and `tracing::warn!` when remaining
    budget drops below 20%.
    (4) `crates/router/src/lib.rs` — re-export a new `RouterMetrics` struct
    that aggregates call count, total tokens, total cost, average latency.
    (5) Add unit tests for `RouterMetrics` in a new test module.
    This is an XL task (5 files, cross-cutting concern) and SHOULD be
    decomposed by the triage agent into smaller sub-tasks.
  priority: 10
  status: pending
  depends_on: []
  decomposition_depth: 0
  remediation_depth: 0
  is_remediation: false
